# PentaSign: Penpot Signature Plugin

This is a [Next.js](https://nextjs.org/) and [Firebase Studio](https://firebase.google.com/studio) project that creates a plugin for [Penpot](https://penpot.app/). The primary goal of this plugin is to provide tools for visually and cryptographically signing documents directly within the Penpot design environment.

## Features

- **Penpot Shape Renderer**: Select any shape or group of shapes on the Penpot canvas and render them as HTML/CSS in a live preview within the plugin. This allows for quick prototyping and code generation from designs.
- **Cryptographic Signature Generation**: Upload a PDF document and provide an identifier (SOFI/ID) to generate a unique, ephemeral signature bundle. This includes a document hash, public key, and a signature.
- **Visual Signature Pattern**: Alongside the cryptographic signature, a unique SVG pattern is generated from the document's hash, providing a visual representation of the signature.
- **Signature Verification**: An AI-powered flow using Google's Gemini model to verify the authenticity of a signed document by providing the document and its cryptographic signature.
- **Modern Tech Stack**: Built with Next.js, React, TypeScript, and Tailwind CSS for a modern and maintainable codebase.
- **Integrated with Penpot**: The plugin is designed to run inside a Penpot iframe and communicates with the Penpot API to access canvas selections.

## Getting Started

The project is structured as a standard Next.js application with specific additions for the Penpot plugin functionality.

### Prerequisites

- Node.js and npm
- A running Penpot instance (can be the cloud version at `penpot.app`)

### Running Locally

1. **Install dependencies**:
   ```bash
   npm install
   ```

2. **Run the development server**:
   ```bash
   npm run dev
   ```
   This command will:
   - Build the Penpot plugin entry point (`src/plugin/plugin.ts`) using `esbuild`.
   - Start the Next.js development server on `http://localhost:9002`.

### Loading the Plugin in Penpot

1. Once the local server is running, go to your Penpot project.
2. Open the Plugin Manager (Shortcut: `Ctrl + Alt + P`).
3. In the "Development" section, enter the URL for the plugin's manifest file:
   ```
   http://localhost:9002/penpot-plugin/manifest.json
   ```
4. Click "Install". The plugin "PentaSign" should now appear in your plugins list and can be opened.

## Project Structure

- `src/app/`: Contains the main pages of the Next.js application which serve as the plugin's UI.
  - `page.tsx`: The main document rendering tool.
  - `sign/page.tsx`: The UI for creating signatures.
  - `verify/page.tsx`: The UI for verifying signatures.
- `src/plugin/plugin.ts`: The entry point for the Penpot plugin. This file tells Penpot how to open the plugin's UI.
- `public/penpot-plugin/`: Contains the compiled plugin code and the manifest file.
  - `code.js`: The bundled plugin code generated by `esbuild`.
  - `manifest.json`: The manifest file that Penpot reads to install the plugin.
- `src/lib/crypto.ts`: Contains the client-side logic for hashing documents and generating cryptographic signatures using the browser's SubtleCrypto API.
- `src/ai/`: Contains the Genkit flows for AI-powered features, such as signature verification.
